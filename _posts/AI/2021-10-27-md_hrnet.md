---
defaults:
  - scope:
      path: ""
      type: posts
    values:
      layout: single
      author_profile: true
      comments: true
      share: true
      related: true

title: "Segmentation Model(HRNet) ì†Œê°œ"
excerpt: "about : segmentation"
toc: true
toc_sticky: true
toc_label: "Label"
categories:
  - ai_models
tags:
  - [Segmentation]
date: 2021-10-27
last_modified_at: 2021-10-27
---

<br>

# HRNet(High Resolution Network)

- ìµœê·¼ ë§ì€ ì—°êµ¬ë“¤ì´ ì´ë¤„ì ¸, HRNet ê¸°ë°˜ìœ¼ë¡œ ë§ì€ ëª¨ë¸ë“¤ì´ ë‚˜ì˜¤ê³  ìˆìŒ
- Semantic Segmentation 1,2ë“± ëª¨ë¸ì´ HRNet ê¸°ë°˜ìœ¼ë¡œ ë§Œë“¤ì–´ì§

## History

- Image Classification Taskì˜ ê²½ìš° ë‹¨ìˆœí•˜ê²Œ imageì˜ í•´ìƒë„ë¥¼ ì¤„ì—¬ê°€ë©° íŠ¹ì§•ì„ ë½‘ì•„ë‚´ëŠ” ì‘ì—…ìœ¼ë¡œ ì´ë¤„ì¡Œìœ¼ë‚˜, Segmentation Taskì˜ ê²½ìš° ìœ„ì¹˜ì •ë³´ê°€ ì¤‘ìš”í•˜ê¸° ë•Œë¬¸ì— í•´ìƒë„ë¥¼ ë‹¤ì‹œ ì˜¬ë¦¬ëŠ” ë°©ì‹ìœ¼ë¡œ ì§„í–‰ë˜ì–´ ì™”ë‹¤
    - í•´ìƒë„ë¥¼ ì¤„ì´ëŠ” ì´ìœ 
    1. ì´ë¯¸ì§€ ë‚´ì˜ ëª¨ë“  íŠ¹ì§•ì´ í•„ìš”í•˜ì§€ ì•ŠìŒ
    2. íš¨ìœ¨ì ì¸ ì—°ì‚° ë° ë„“ì€ receptive fieldë¥¼ ê°–ìŒ
    3. ì¤‘ìš”í•œ íŠ¹ì§•ë§Œ ì¶”ì¶œí•˜ì—¬ ê³¼ì í•© ë°©ì§€

![image](https://user-images.githubusercontent.com/77658029/138817077-d66e9c32-d737-46ef-ad3f-15ce67b5170d.png)

- Segmentation íŠ¹ì§•
    - ì´ë¯¸ì§€ì˜ ê³µê°„ì ì¸ ì •ë³´ê°€ ì¤‘ìš”í•˜ê³  í”½ì…€ ì£¼ë³€ì˜ context íŒŒì•…ì´ ì¤‘ìš”í•´ì§
    - ëª¨ë“  í”½ì…€ì˜ ìì„¸í•œ ì •ë³´ê°€ í•„ìš”í•¨(poolingì„ í•  ê²½ìš° í”½ì…€ ì •ë³´ë¥¼ ìƒê¸° ë•Œë¬¸ì— ë¶ˆë¦¬í•´ì§)
    
- segmentation modelë“¤
    - FCN, DeconvNet, SegNet, U-Net..
    - Receptive fieldë¥¼ ë†’ì´ê¸° ìœ„í•´ í•´ìƒë„ë¥¼ ê·¹ë‹¨ì ìœ¼ë¡œ ë‚®ì¶˜ í›„ ë‹¤ì‹œ upsamplingì„ í†µí•´ í•´ìƒë„ë¥¼ ë³µêµ¬í•˜ì—¬ ì‚¬ìš©í•˜ê²ŒëëŠ”ë°, í•´ìƒë„ë¥¼ ë‚®ì¶”ëŠ” ê³¼ì •ì—ì„œ ì •ë³´ì†ì‹¤ì´ ì¼ì–´ë‚˜ ë³µêµ¬í•´ë„ í•´ìƒë„ê°€ ë‚®ê²Œë¨

![image](https://user-images.githubusercontent.com/77658029/138817737-a2600767-2b69-4770-8a13-99d38014c721.png)

- ê¸°ì¡´ Segmentation modelì˜ ë‹¨ì  ë³´ì™„(DeepLabV3+, DilatedNet)
    - í•´ìƒë„ëŠ” ë†’ê²Œ ìœ ì§€, ë„“ì€ Receptive Fieldë¥¼ ê°–ì„ ìˆ˜ ìˆë„ë¡
    - Dilated Convolution ì‚¬ìš©
    - í•˜ì§€ë§Œ ì•„ì§ í•´ìƒë„ë¥¼ ì¤„ì—¬ì„œ ì˜ˆì¸¡í•¨
![image](https://user-images.githubusercontent.com/77658029/138818258-90853a7f-9645-4b28-816d-6d87b6a317be.png)

![image](https://user-images.githubusercontent.com/77658029/138818332-5ebbfbe7-de1d-43fb-9358-894bc9e55fbd.png)

<br>

ì´ì „ segmentation Modelë“¤ì„ ë³´ì™„í•˜ê¸° ìœ„í•´ì„œ ì¤‘/ì € í•´ìƒë„ â†’ ê³ í•´ìƒë„ ë³µì›ì´ ì•„ë‹Œ ê³ í•´ìƒë„ë¥¼ ìœ ì§€í•˜ê¸° ìœ„í•œ ë°©ë²•ìœ¼ë¡œ **HRNet**ì´ ê³ ì•ˆë¨


## êµ¬ì„±

- ê³ í•´ìƒë„ì˜ imageë¥¼ ëê¹Œì§€ ê°€ì ¸ê°€ë©° ì¤‘ê°„ì— ì¤‘/ì € í•´ìƒë„ì˜ image ì •ë³´ë¥¼ ë°›ì•„ì„œ ì²˜ë¦¬í•˜ëŠ” í˜•íƒœ
- ê³ í•´ìƒë„(HR)ì„ ìœ ì§€í•˜ë©° ì—°ì‚°ì´ì§„í–‰ë¨(ì‹¤ì œ ì´ë¯¸ì§€ì˜ 1/4í¬ê¸°)
- 1/4ë¡œ ì¤„ì´ëŠ”ë° ì™œ HRë¡œ ë¶ˆë¦´ê¹Œ?
    ì§€ê¸ˆê¹Œì§€ Deeplabv3+(1/16), U-net(1/20)ì˜ ê²½ìš° input imageì˜ í•´ìƒë„ë¥¼ ë‚®ì¶°ì„œ ì—°ì‚°í•´ì™”ì—ˆì§€ë§Œ, HRNetì˜ ê²½ìš° 1/4 ì •ë„ë¡œë§Œ ì¤„ì—¬ì„œ ì‚¬ìš©í–ˆê¸° ë•Œë¬¸ì— ìƒëŒ€ì ìœ¼ë¡œ ê³ í•´ìƒë„ì˜ visual recognitionì´ ê°€ëŠ¥í•¨

![image](https://user-images.githubusercontent.com/77658029/138811011-ce5fd465-564e-4eae-ac00-b2e5ae260803.png)

![image](https://user-images.githubusercontent.com/77658029/138811184-1b8bbb4a-7987-4aee-b6ba-e7ef334986b7.png)

- ê³ í•´ìƒë„ â†” ì €í•´ìƒë„ summationì„ í†µí•´ ìœ„ì¹˜ ë¯¼ê°ë„ì™€ í”½ì…€ì— ëŒ€í•œ Semantic ì •ë³´ë¥¼ ì ì ˆí•˜ê²Œ ì„ì–´ì¤Œ

![image](https://user-images.githubusercontent.com/77658029/138819742-eab02202-52a4-4d1d-b5f7-296d2e3b1910.png)

### Taskì— ë”°ë¥¸ Representation Head ì¢…ë¥˜

1. HRNetV1 : ìµœì¢… ì¶œë ¥ìœ¼ë¡œ ì €í•´ìƒë„ ì •ë³´ëŠ” ë¹¼ê³  ê³ í•´ìƒë„ íŠ¹ì§•ë§Œì„ ì‚¬ìš©í•˜ì—¬ **PoseEstimation Task**ì— í™œìš©

![image](https://user-images.githubusercontent.com/77658029/138820102-1b797b9a-875b-48f6-88b1-84fbdf8f066c.png)

2. HRNetV2 : ì €í•´ìƒë„ íŠ¹ì§•ë“¤ì„ Bilinear Upsamplingì„ í†µí•´ ê³ í•´ìƒë„ í¬ê¸°ë¡œ ë³€í™˜í•˜ì—¬ ì¶œë ¥ìœ¼ë¡œ ì‚¬ìš©í•˜ì—¬ **Semantic Segmentation task**ì— í™œìš©

![image](https://user-images.githubusercontent.com/77658029/138820230-b9e0753f-53f8-4fbc-a95a-09484a174286.png)


3. HRNetV2P : HRNetV2ì˜ ê²°ê³¼ì—ì„œ Downsampling ì§„í–‰ í›„ ì¶œë ¥í•˜ì—¬ **Object Detection**ì— í™œìš© 

![image](https://user-images.githubusercontent.com/77658029/138820404-eb7fa9a8-f209-4f03-9006-96971356500d.png)

## êµ¬í˜„

![image](https://user-images.githubusercontent.com/77658029/138908071-794bb01a-81c6-4f4c-ae84-0bf712c308fe.png)

**Stage1**
```python
block1 : ("input(ch.64)â†’conv(1x1,ch.64)â†’BNâ†’reluâ†’conv(1x1,ch.256)â†’BNâ†’reluâ†’conv(1x1)â†’BN" + "input(ch.64)â†’conv(1x1,ch.256)â†’BN")â†’relu 
block2 : ("input(ch.256)â†’conv(1x1,ch.256)â†’BNâ†’reluâ†’conv(1x1,ch.256)â†’BNâ†’reluâ†’conv(1x1)â†’BN" + "input(ch.256)")â†’relu
block3 : ("input(ch.256)â†’conv(1x1,ch.256)â†’BNâ†’reluâ†’conv(1x1,ch.256)â†’BNâ†’reluâ†’conv(1x1)â†’BN" + "input(ch.256)")â†’relu    
block4 : ("input(ch.256)â†’conv(1x1,ch.256)â†’BNâ†’reluâ†’conv(1x1,ch.256)â†’BNâ†’reluâ†’conv(1x1)â†’BN" + "input(ch.256)")â†’relu
highâ†’high block : "input(ch.256)â†’conv(3x3,ch.48)â†’BNâ†’relu"
highâ†’low block : "input(ch.256)â†’conv(3x3,ch.96,stride=2)â†’BNâ†’relu" ì´ë¯¸ì§€ í¬ê¸° 1/2
```

**Stage2**
```python
block1_lv1 x4: ("input(ch.48)â†’conv(3x3,ch.48)â†’BNâ†’reluâ†’conv(3x3,ch.48)â†’BN" + "input(ch.48)")â†’relu
block1_lv2 x4: ("input(ch.96)â†’conv(3x3,ch.96)â†’BNâ†’reluâ†’conv(3x3,ch.96)â†’BN" + "input(ch.96)")â†’relu 

highâ†’high block : "input(ch)â†’conv(3x3,ch)â†’BNâ†’relu"
highâ†’low block : "input(ch*2^n)â†’conv(3x3,ch*2^n)â†’BNâ†’relu"ì´ë¯¸ì§€ í¬ê¸° 1/2ë°°
lowâ†’high block : "input(ch/2^n)â†’conv(3x3,ch/2^n)â†’BNâ†’relu" ì´ë¯¸ì§€ í¬ê¸° 2ë°°
```

**Stage3** x4
```python
block1_lv1 x4: ("input(ch.48)â†’conv(3x3,ch.48)â†’BNâ†’reluâ†’conv(3x3,ch.48)â†’BN" + "input(ch.48)")â†’relu
block1_lv2 x4: ("input(ch.96)â†’conv(3x3,ch.96)â†’BNâ†’reluâ†’conv(3x3,ch.96)â†’BN" + "input(ch.96)")â†’relu 
block1_lv3 x4: ("input(ch.192)â†’conv(3x3,ch.192)â†’BNâ†’reluâ†’conv(3x3,ch.192)â†’BN" + "input(ch.192)")â†’relu 
highâ†’high block : "input(ch)â†’conv(3x3,ch)â†’BNâ†’relu"
highâ†’low block : "input(ch*2^n)â†’conv(3x3,ch*2^n)â†’BNâ†’relu"ì´ë¯¸ì§€ í¬ê¸° 1/2^në°°
lowâ†’high block : "input(ch/2^n)â†’conv(3x3,ch/2^n)â†’BNâ†’relu" ì´ë¯¸ì§€ í¬ê¸° 2^në°°
```

**Stage4** x3
```python
block1_lv1 x4: ("input(ch.48)â†’conv(3x3,ch.48)â†’BNâ†’reluâ†’conv(3x3,ch.48)â†’BN" + "input(ch.48)")â†’relu 
block1_lv2 x4: ("input(ch.96)â†’conv(3x3,ch.96)â†’BNâ†’reluâ†’conv(3x3,ch.96)â†’BN" + "input(ch.96)")â†’relu 
block1_lv3 x4: ("input(ch.192)â†’conv(3x3,ch.192)â†’BNâ†’reluâ†’conv(3x3,ch.192)â†’BN" + "input(ch.192)")â†’relu 
block1_lv4 x4: ("input(ch.384)â†’conv(3x3,ch.384)â†’BNâ†’reluâ†’conv(3x3,ch.384)â†’BN" + "input(ch.384)")â†’relu 
highâ†’high block : "input(ch)â†’conv(3x3,ch)â†’BNâ†’relu"
highâ†’low block : "input(ch*2^n)â†’conv(3x3,ch*2^n)â†’BNâ†’relu"ì´ë¯¸ì§€ í¬ê¸° 1/2^në°°
lowâ†’high block : "input(ch/2^n)â†’conv(3x3,ch/2^n)â†’BNâ†’relu" ì´ë¯¸ì§€ í¬ê¸° 2^në°°
```


<br><br>

**ğŸ“Œreference**
- boostcourse AI tech

<br>

```
ğŸ’¡ ìˆ˜ì • í•„ìš”í•œ ë‚´ìš©ì€ ëŒ“ê¸€ì´ë‚˜ ë©”ì¼ë¡œ ì•Œë ¤ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤!ğŸ’¡ 
```
