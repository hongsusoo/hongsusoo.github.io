---
defaults:
  - scope:
      path: ""
      type: posts
    values:
      layout: single
      author_profile: true
      comments: true
      share: true
      related: true

title: "Segmentation Model(Unet,Unet++,Unet3+) ì†Œê°œ"
excerpt: "about : segmentation"
toc: true
toc_sticky: true
toc_label: "Label"
categories:
  - DL
tags:
  - [Segmentation]
date: 2021-10-21
last_modified_at: 2021-10-21
---

<br>

# U-Net

## U-Net íŠ¹ì§•

- biomedical image ë¶„ì•¼ì—ì„œ ë‚˜ì˜¨ ë…¼ë¬¸ìœ¼ë¡œ 2015ë…„ ì €ìˆ ëœ ì´í›„ ë§ì€ ê³³ì—ì„œ ì¸ìš©ë˜ê³  ìˆìŒ
- ì˜ë£Œê³„ì—´ì—ì„œ ì‚¬ìš©ëœ ì ì ˆí•œ Deep learning ëª¨ë¸ë¡œ, í•´ê²°í•´ì•¼í•˜ëŠ” Taskì— ì˜ ë§ì¶°ì„œ í•´ê²°í•œ ëª¨ë¸
- ì˜ë£Œê³„ì—ì„œì˜ Deep learning ì ìš©ì´ ì–´ë ¤ìš´ ì´ìœ 
    - ì˜ë£Œ ê³„ì—´ì—ì„œëŠ” ë°ì´í„°ê°€ ë¶€ì¡±í•œ ê²½ìš°ê°€ ë§ì€ë°, deep learningì˜ íŠ¹ì„±ìƒ ë„¤íŠ¸ì›Œí¬ê°€ ê¹Šì–´ train dataê°€ ë§ì´ í•„ìš”í•¨
    ![image](https://user-images.githubusercontent.com/77658029/139783961-2c134419-6cb8-4c05-8740-2280c123ae85.png)
    - Cell Segmentationì‘ì—…ì˜ ê²½ìš° ì¸ì ‘í•œ cellê³¼ ê°™ì´ ë™ì¼í•œ í´ë˜ìŠ¤ê°€ ë¶™ì–´ìˆëŠ” ê²½ìš° êµ¬ë¶„ì´ ì–´ë ¤ì›€(ì¸ì ‘í•´ ìˆëŠ” ì…€ ì‚¬ì´ì˜ ê²½ê³„ êµ¬ë¶„ì´ í•„ìš”í•¨) â†’ ì…€ ì‚¬ì´ì˜ ê²½ê³„ì„ ì„ ë”°ë¡œ êµ¬ë¶„í•´ì£¼ëŠ” ì‘ì—…ì´ í•„ìš”í•¨
    

## êµ¬ì¡°

![image](https://user-images.githubusercontent.com/77658029/139784736-6a14252a-67c9-4e55-933e-7dd800759967.png)

- ëŒ€ì¹­ìœ¼ë¡œ ì´ë¤„ì§„ Contracting Path(maxpooling)ì™€ Expanding Path(up_conv) êµ¬ì¡°

```
U-Net(Contracting Path)ì˜ êµ¬ì¡°
Layer 1 : [convâ†’BNâ†’reluâ†’convâ†’BNâ†’relu] # Paddingì„ ì ìš©í•˜ì§€ ì•Šì•„ ì‚¬ì´ì¦ˆê°€ ê°ì†Œ(size : 572 â†’ 570 â†’ 568), 64channel
Layer 2 : Layer1 output(max pooling) â†’ [convâ†’BNâ†’reluâ†’convâ†’BNâ†’relu] # Layer 1ê³¼ ë™ì¼í•˜ê²Œ No Padding(size : 284 â†’ 282 â†’ 280), 128 channel
Layer 3 : Layer2 output(max pooling) â†’ [convâ†’BNâ†’reluâ†’convâ†’BNâ†’relu] # (size : 140 â†’ 138 â†’ 136), 256 channel
Layer 4 : Layer3 output(max pooling) â†’ [convâ†’BNâ†’reluâ†’convâ†’BNâ†’relu] # (size : 68 â†’ 66 â†’ 64), 512 channel
Layer 5 : Layer4 output(max pooling) â†’ [convâ†’BNâ†’reluâ†’convâ†’BNâ†’relu] # (size : 32 â†’ 30 â†’ 28), 1024 channel
```

```
U-Net(Expanding Path)ì˜ êµ¬ì¡°
expanding Layer 4 : (Layer5 output(up_conv, 56x56x512) + Layer4 output(64x64x512â†’56x56x512 crop) â†’ [convâ†’BNâ†’reluâ†’convâ†’BNâ†’relu] # (size : 56 â†’ 54 â†’ 52), 512 channel
expanding Layer 3 : (Layer4 output(up_conv, 104x104x256) + Layer3 output(136x136x256â†’104x104x256 crop) â†’ [convâ†’BNâ†’reluâ†’convâ†’BNâ†’relu] # (size : 104 â†’ 102 â†’ 100), 256 channel
expanding Layer 2 : (Layer3 output(up_conv, 200x200x128) + Layer2 output(280x280x128â†’200x200x128 crop) â†’ [convâ†’BNâ†’reluâ†’convâ†’BNâ†’relu] # (size : 200 â†’ 198 â†’ 196), 128 channel
expanding Layer 1 : (Layer3 output(up_conv, 392x392x64) + Layer2 output(568x568x64â†’392x392x64 crop) â†’ [convâ†’BNâ†’reluâ†’convâ†’BNâ†’reluâ†’conv(1x1)] # (size : 392 â†’ 390 â†’ 388 â†’ 388), 2 channel
```

## Data Augmentation

- Random Elastic Deformation : ë¬¼ê±´ì— ì™¸ë ¥ì„ ê°€í•œ ëŠë‚Œìœ¼ë¡œ ë³€í˜•ì„ ì£¼ì–´ ì„¸í¬ì˜ ì—¬ëŸ¬ ëª¨ì–‘ì„ í•™ìŠµ í•˜ê²Œ ë§Œë“¤ì–´ robustí•˜ê²Œ í•™ìŠµí•¨

## Pixel wise loss weight ì ìš©

- ê°™ì€ í´ë˜ìŠ¤ë¥¼ ê°€ì§€ëŠ” ì¸ì ‘í•œ ì…€ì„ ë¶„ë¦¬í•˜ê¸° ìœ„í•´ ê²½ê³„ë¶€ë¶„ì— ê°€ì¤‘ì¹˜ë¥¼ ì œê³µ

![image](https://user-images.githubusercontent.com/77658029/139787338-7bd0a814-6777-44f0-9aa0-56bc149fba6e.png)

## U-Netì˜ í•œê³„ì 

- ê¹Šì´ê°€ 4ë¡œ ê³ ì •ë˜ì–´ ìˆì–´ ë°ì´í„°ì…‹ë§ˆë‹¤ ìµœê³ ì˜ ì„±ëŠ¥ì„ ë³´ì¥í•˜ì§€ ì•Šì•„ ìµœì  ê¹Šì´ì— ëŒ€í•œ íƒìƒ‰ ë¹„ìš©ì´ ì¦ê°€í•˜ê²Œë¨
- ë‹¨ìˆœí•œ Skip connection : ë™ì¼í•œ ê¹Šì´ë¥¼ ê°€ì§€ëŠ” Encoderì™€ Decoderë§Œ ì—°ê²°ë˜ëŠ” ì œí•œëœ êµ¬ì¡°

# U-Net ++

## íŠ¹ì§•
- U-Netì˜ ë‘ê°€ì§€ í•œê³„ì ì¸ ê¹Šì´ ê³ ì •, ë‹¨ìˆœí•œ skip connectionêµ¬ì¡°ë¥¼ ê°œì„ í•œ ëª¨ë¸
    1. Encoderë¥¼ ê³µìœ í•˜ëŠ” ë‹¤ì–‘í•œ ê¹Šì´ì˜ U-Netì„ ìƒì„±
    ![image](https://user-images.githubusercontent.com/77658029/139788544-3d4420d1-07f7-4cce-8779-fcddfa34ab19.png)
    2. ë‹¤ì–‘í•œ Skip connection êµ¬ì¡°
    ![image](https://user-images.githubusercontent.com/77658029/139788159-7ff943e3-653a-4c0f-8a19-9c938664081f.png)
    3. Ensemble íš¨ê³¼
    ![image](https://user-images.githubusercontent.com/77658029/139788797-9fd9bfc9-8411-43a1-9eba-a338910cca50.png)
    
## Hybrid Loss

- pixel wise Cross Entropì™€ Soft Dice Coefficientë¥¼ í•¨ê»˜ ì‚¬ìš©
- depthì— ë”°ë¥¸ lossì˜ í‰ê· ì„ Lossë¡œ ì‚¬ìš©

![image](https://user-images.githubusercontent.com/77658029/139789649-9f01fd91-d22f-42ff-a078-ef06c985a008.png)

## U-Net ++ í•œê³„ì 

- ë³µì¡í•œ connectionìœ¼ë¡œ parameter ìˆ˜ ì¦ê°€
- ë§ì€ connectionìœ¼ë¡œ ì¸í•œ Memory ì¦ê°€
- Encoder-Decoder ì‚¬ì´ì—ì„œì˜ Connectionì´ ë™ì¼í•œ í¬ê¸°ë¥¼ ê°–ëŠ” Feature mapì—ì„œë§Œ ì§„í–‰ë¨(Full Scaleì—ì„œ ì¶©ë¶„í•œ ì •ë³´ë¥¼ íƒìƒ‰í•˜ì§€ ëª»í•´ ìœ„ì¹˜ì™€ ê²½ê³„ë¥¼ ëª…ì‹œì ìœ¼ë¡œ í•™ìŠµí•˜ì§€ ëª»í•¨)


# U-Net 3+

## íŠ¹ì§• 

- ë™ì¼í•œ í¬ê¸°ì˜ feature mapì—ì„œë§Œ ì§„í–‰ë˜ê³ , ë³µì¡í•œ ì—°ì‚°ì„ ì¤„ì´ê¸° ìœ„í•œ ì‹œë„ë“¤ì´ ì¶”ê°€ë¨
- ë‹¤ì–‘í•œ Feature map ì‚¬ìš© : Full Scale Skip Connections
    - Conventional : Encoderë¡œ ë¶€í„° Same-Scaleì˜ Feature mapsë¥¼ ë°›ìŒ
    - Inter : Encoderë¡œ ë¶€í„° Low Level Feature mapsë¥¼ ë°›ìŒ(í’ë¶€í•œ ê³µê°„ì •ë³´ë¡œ ê²½ê³„ ê°•ì¡°)
    - Inter : Decoderë¡œ ë¶€í„° Larger -Scaleì˜ high levelì˜ Feature mapsì •ë³´ë¥¼ ë°›ì•„(ìœ„ì¹˜ ì •ë³´ë¥¼ êµ¬í˜„)
 
- parameter ìˆ˜ ê°œì„ 
    - Skip Connectionì—ì„œ ì •ë³´ë¥¼ ë°›ì•„ì˜¬ë•Œ channel ìˆ˜ë¥¼ 64ë¡œ ê³ ì •í•˜ì—¬ ì „ì²´ Channelì´ 320 channelì´ ë  ìˆ˜ ìˆê²Œ ê³ ì •í•˜ì—¬ ì—°ì‚°ëŸ‰ì„ ì¤„ì„
    ![image](https://user-images.githubusercontent.com/77658029/139791165-4b468525-27d5-45ee-88b4-1c2ce9e25ba3.png)
    
    
## CGM(Classification Guided Module)

- low-level layerì— ë‚¨ì•„ìˆëŠ” Background noiseë¥¼ ë°œìƒí•˜ì—¬ ë§ì€ False positive ë¬¸ì œë¥¼ ë°œìƒ
- ì •í™•ë„ë¥¼ ë†’ì´ê¸° ìœ„í•´ Classification taskë¥¼ ì¶”ê°€ì ìœ¼ë¡œ ì§„í–‰í•˜ì—¬ argmaxë¥¼ í†µí•´ objectê°€ ìˆìœ¼ë©´ 1 ì—†ìœ¼ë©´ 0ì„ ê³±í•˜ëŠ” ì—°ì‚°ì„ ì§„í–‰í•¨

![image](https://user-images.githubusercontent.com/77658029/139791285-8fdf6359-da25-4dd9-894c-e3a2c838044e.png)

## Full Scale Deep Supervision loss

- ê²½ê³„ ë¶€ë¶„ì„ í•™ìŠµí•˜ê¸° ìœ„í•œ ì—¬ëŸ¬ Loss ê²°í•©
![image](https://user-images.githubusercontent.com/77658029/139791622-a57c9ac3-c9c0-4c4c-ad06-bbd6ca53610f.png)

  
<br><br>

**ğŸ“Œreference**
- boostcourse AI tech
- [U-Net ë…¼ë¬¸](https://arxiv.org/abs/1505.04597)
- [U-Net++ ë…¼ë¬¸](https://arxiv.org/abs/1807.10165)
- [U-Net3+ ë…¼ë¬¸](https://arxiv.org/abs/2004.08790)

<br>

```
ğŸ’¡ ìˆ˜ì • í•„ìš”í•œ ë‚´ìš©ì€ ëŒ“ê¸€ì´ë‚˜ ë©”ì¼ë¡œ ì•Œë ¤ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤!ğŸ’¡ 
```
