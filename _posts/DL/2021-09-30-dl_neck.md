---
defaults:
  - scope:
      path: ""
      type: posts
    values:
      layout: single
      author_profile: true
      comments: true
      share: true
      related: true

title: "Neck(2 stage detection model) êµ¬ì¡° ì„¤ëª…"
excerpt: "about : object detection"
toc: true
toc_sticky: true
toc_label: "Label"
categories:
  - DL
tags:
  - [Object Detection]
date: 2021-09-30
last_modified_at: 2021-09-30
---

<br>

# Neck

<br><br>

## Neckì´ë€ ë­˜ê¹Œ?

- ê¸°ì¡´ 2 stage êµ¬ì¡°ì—ì„œëŠ” ë§ˆì§€ë§‰ feature mapë¥¼ ì‚¬ìš©
- ì™œ? ë§ˆì§€ë§‰ Feature mapë§Œì„ ì‚¬ìš©í•´ì•¼í•˜ë‚˜ë¼ëŠ” ì˜ë¬¸ì—ì„œ Neckì˜ ê°œë…ì´ ë°œìƒí•¨
- ë‹¤ë¥¸ feature map ì—ì„œë„ RPNë¥¼ êµ¬í•˜ë©´ ì–´ë–¨ê¹Œ?

![image](https://user-images.githubusercontent.com/77658029/135186705-661c22ac-32d6-43f6-aa78-6c2ea02f53d5.png)

<br><br><br>

## Neckì€ ì™œ í•„ìš”í• ê¹Œ?

- detection taskì˜ ê²½ìš° ë‹¤ì–‘í•œ í¬ê¸°ì˜ objectë¥¼ ì˜ˆì¸¡í•´ì•¼í•¨
- ì¼ë°˜ì ìœ¼ë¡œ high level(ê¹Šì€ layer)ì˜ feature mapì€ í° object ì •ë³´, semantic ì •ë³´ë¥¼ ê°€ì§€ê³  ìˆê³ 
- low levelì˜ feature mapì€ objectì˜ fineí•œ íŠ¹ì„±ì„ ê°€ì§€ê³  ìˆì–´ì„œ, ìƒëŒ€ì ìœ¼ë¡œ ì‘ì€ objectì— ëŒ€í•œ ì •ë³´ë¥¼ ê°€ì§€ê³  ìˆìŒ
- Neckì€ ì´ëŸ° trade off ê´€ê³„ë¥¼ ì´ìš©í•˜ëŠ” ê¸°ë²•

![image](https://user-images.githubusercontent.com/77658029/135189700-0796bf56-e76c-430e-afa7-a241e3ad1297.png)

**ğŸ“Œ ë‹¤ì–‘í•œ í¬ê¸°ì˜ objectë¥¼ detection í•˜ê¸° ìœ„í•´ì„œ Neckë¥¼ ì‚¬ìš©**

<br><br><br>

## FPN(Feature Pyramid Network)

- high levelì—ì„œ low levelë¡œ semantic ì •ë³´ë¥¼ ì „ë‹¬í•˜ëŠ” ê¸°ë²•ì„ ì‚¬ìš©
- top-down path way ì¶”ê°€

![image](https://user-images.githubusercontent.com/77658029/135189489-b4b02913-e94c-440d-8c5f-1a9c3fa4ccbc.png)

<br><br>

### Top-Down

- Top-Down ë°©ì‹ì„ ì‚¬ìš©í•˜ë©´ high levelì˜ featureë¥¼ low levelë¡œ ë³´ë‚´ì¤˜ì•¼í•¨
- ì´ë•Œ feature mapì˜ sizeì™€ channelì˜ ìˆ˜ê°€ ì°¨ì´ê°€ ë‚˜ê¸° ë•Œë¬¸ì— ì¼ë ¨ì˜ ì¡°ì •ê³¼ì •ì´ í•„ìš”í•¨
- low levelì—ì„œ low levelì˜ Neckìœ¼ë¡œ ê°ˆë•ŒëŠ” 1x1 convë¥¼ ì‚¬ìš©
- high levelì—ì„œ low levelë¡œ ì˜¬ë•ŒëŠ” 2ë°° up samplingë¥¼ ì‚¬ìš©
- ë‘ ê°œì˜ feature mapì„ ë”í•´ì¤€ë‹¤

![image](https://user-images.githubusercontent.com/77658029/135189950-e2a4eb17-b9cd-415e-820f-a54f8f18b109.png)

- FPNì€ Nearest Neighbor Upsampling ì‚¬ìš©

![image](https://user-images.githubusercontent.com/77658029/135190474-ad80febb-69a6-4dbd-bc2c-64bcc8e55919.png)

<br><br>

### pipline 

- backbone : ResNet ì‚¬ìš©

![image](https://user-images.githubusercontent.com/77658029/135190633-a5e4875c-bec3-4d12-b381-ea7f91e414f2.png)

- ê° levelì˜ feature mapì—ì„œ ê°ê° RoIë¥¼ í†µí•´ ë½‘ì€ bboxë¥¼ í•œë²ˆì— NMS ì§„í–‰í•¨

![image](https://user-images.githubusercontent.com/77658029/135190810-c1a04e66-90df-47b7-bdb1-c1a14fc08178.png)

<br><br>

### FPN ë‹¨ì 

- ResNetì˜ íŠ¹ì„±ìƒ layerê°€ ë§ì•„ bottom up í•˜ëŠ” ê³¼ì •ì—ì„œ low levelì˜ feature ì •ë³´ê°€ high levelê¹Œì§€ ê°€ê¸° ì–´ë ¤ì›€
- RoIì‹œ  objectì˜ w,h í¬ê¸°ì— ë”°ë¼ projectí•˜ëŠ” stage(feature map)ë¥¼ ì •í•˜ê²Œ ë˜ëŠ”ë°, ëª‡ pixelì°¨ì´ì— ì˜í•´ stageê°€ ë°”ë€ŒëŠ” ê²½ìš°ê°€ ìˆìŒ

<br><br><br>

## PANet(Path Aggregation Network)

- FPNì˜ ë‹¨ì ì„ ë³´ì™„í•˜ê¸° ìœ„í•œ ëª¨ë¸
- FPNì˜ top-down ë°©ì‹ í›„ì— bottom-upë¥¼ í•œë²ˆ ë” í•´ì¤˜ Low levelì˜ feature ê°’ì„ high levelì— ë„˜ê²¨ì¤Œ
- FPNì˜ ROI ë°©ì‹ì—ì„œ object í¬ê¸°ì— ë”°ë¥¸ stageë¥¼ ì •í•´ì£¼ëŠ” ë°©ì‹ì´ ì•„ë‹Œ ê° Stageì—ì„œ ëª¨ë‘ RoIë¥¼ ì§„í–‰í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì‚¬ìš©


![image](https://user-images.githubusercontent.com/77658029/135193553-79a9c269-d93f-4de9-9432-3e914a43f418.png)

<br><br><br>

## DetectoRS

### Recursive Feature Pyramid(RFP)

- neckìœ¼ë¡œ ë½‘ì•„ë‚¸ featureë¥¼ backboneìœ¼ë¡œ ë‹¤ì‹œ íšŒê·€ì‹œí‚¤ëŠ” ë°©ë²•
- low level ê³„ì‚°ì‹œ high levelì˜ ì •ë³´ë¥¼ í•¨ê»˜ ì‚¬ìš©í•  ìˆ˜ ìˆì§€ë§Œ, backboneì„ ì—¬ëŸ¬ë²ˆ ì—°ì‚°í•˜ê²Œ ë˜ì–´ ì—°ì‚°ìˆ˜ê°€ ì»¤ì§

![image](https://user-images.githubusercontent.com/77658029/135870096-b3a45a00-02f2-4148-9743-992fdfa16803.png)

![image](https://user-images.githubusercontent.com/77658029/135872238-5f435e8e-6a34-42df-b7ca-f00ecafc73f1.png)

<br><br>

### ASPP

- convolution ì—°ì‚°ì‹œ ê¸°ì¡´ì—” filterê°€ ì—°ì†ì ìœ¼ë¡œ ì´ë¤„ì ¸ ìˆì§€ë§Œ, Atrous(dilated) convolutionì˜ ê²½ìš° dilation rateë§Œí¼ ë–¨ì–´ì§„ filterë¥¼ ì‚¬ìš©í•˜ì—¬ receptive fieldê°’ì„ í‚¤ì›Œì¤Œ

![image](https://user-images.githubusercontent.com/77658029/135872920-32911c73-1914-4fd0-86bd-643243479b23.png)

<br><br><br>

## Bi-directional Feature Pyramid(BiFPN)

- feature mapì´ í•œê³³ì—ì„œ ì˜¤ëŠ” nodeë¥¼ ì œê±°í•´ ì—°ì‚° ìˆ˜ë¥¼ ì¤„ì„
- ì›ë˜ ê¸°ì¡´ FPNì˜ ê²½ìš° upsamplingê³¼ convolutionì„ í†µí•´ì„œ ì‚¬ì´ì¦ˆë¥¼ ë§ì¶° ë‹¨ìˆœ í•©ì„ ì§„í–‰í–ˆì—ˆëŠ”ë°
- BiFPNì—ì„œëŠ” weightë¥¼ ì£¼ëŠ” ë°©ì‹ì„ ì œì‹œí•¨(featureë³„ ê°€ì¤‘ì¹˜ë¥¼ í†µí•´ ì¤‘ìš”í•œ featureë¥¼ ê°•ì¡°í•˜ì—¬ ì„±ëŠ¥ ìƒìŠ¹)

![image](https://user-images.githubusercontent.com/77658029/135874242-61c652ec-5e09-48fd-a958-c0ce2d6db5e8.png)

<br><br><br>

## NASFPN

- ê¸°ì¡´ FPNì˜ êµ¬ì¡°ëŠ” ì‚¬ëŒì´ heuristicsí•˜ê²Œ ì •ì˜í•˜ì—¬ ì‚¬ìš©
- ë‹¨ìˆœ ì¼ë°©í–¥ summation ë°©ì‹ì´ ì‚¬ìš©ë¨
- FPN ì•„í‚¤í…ì²˜ë¥¼ NASë¥¼ í†µí•˜ì—¬ ì°¾ëŠ” ë°©ë²•

![image](https://user-images.githubusercontent.com/77658029/135875779-4fc0634a-e788-4889-b6af-057e60ee4e28.png)

- COCO dataset, ResNet ê¸°ì¤€ìœ¼ë¡œ ì°¾ì€ êµ¬ì¡°ë¡œ ë²”ìš©ì ì´ì§€ ëª»í•¨(parameterê°€ ë§ì´ ì†Œìš”)
- Datasetì´ë‚˜ Backboneì´ ë°”ë€” ê²½ìš° ìƒˆë¡œìš´ architectureë¥¼ ì°¾ê¸° ìœ„í•œ Search costê°€ ë§ì´ ì†Œìš”ë¨

<br><br><br>

## AugFPN

- FPN ê¸°ì¤€ìœ¼ë¡œ ë‹¨ì ì„ ë³´ì™„í•œ ëª¨ë¸
- ì œì¼ ìœ„ì— levelì—ì„œëŠ” ë‹¨ìˆœ conv 1x1, conv 3x3ìœ¼ë¡œ ì¸í•œ ì •ë³´ ì†ì‹¤
-  ë‹¤ë¥¸ levelì—ì„œëŠ” top down ë°©ì‹ìœ¼ë¡œ ì •ë³´ê°€ ì–´ëŠ ì •ë„ ë³´ì™„
- ì œì¼ ìœ„ì— ìˆëŠ” ì •ë³´ë¥¼ ìµœëŒ€í•œ ë³´ì¡´í•˜ê¸° ìœ„í•´ RFA(M6)ë¥¼ ì¶”ê°€í•¨

![image](https://user-images.githubusercontent.com/77658029/135878084-5845d9b5-2d7c-4256-afb3-20c819aa5e02.png)

<br><br>

### Residual Feature  Augmentation

1. ì—¬ëŸ¬ ì‚¬ì´ì¦ˆë¡œ adaptive poolingì„ ì§„í–‰
2. ì—¬ëŸ¬ feature mapì„ ë”í•˜ê¸° ìœ„í•´ upsamplingì§„í–‰
3. ëª¨ë‘ concatí•œ ì´í›„ conv 1x1, conv 3x3 ìœ¼ë¡œ channelì„ ì¡°ì •í•´ì¤Œ
4. channel ê¸°ì¤€ìœ¼ë¡œ sigmoidë¥¼ í•˜ì—¬ channelì— ë”°ë¥¸ ê°€ì¤‘ì¹˜ë¡œ Residual Feature Augmentationì„ ë§Œë“¤ì–´ì¤Œ

![image](https://user-images.githubusercontent.com/77658029/135878929-9ca9b66b-e536-47a6-a19e-337bd3538a3d.png)

<br><br>

### Soft ROI Selection

- FPNê³¼ ê°™ì´ í•˜ë‚˜ì˜ Feature Mapì—ì„œ ROIë¥¼ ê³„ì‚°í•  ê²½ìš° ì •ë³´ ì†ì‹¤ì´ ì¼ì–´ë‚¨
- ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ PANetì—ì„œ ëª¨ë“  Feature mapì„ ì‚¬ìš©í•˜ì˜€ì°Œë§Œ, Max poolingìœ¼ë¡œ ì¸í•œ ì •ë³´ ì†ì‹¤ ê°€ëŠ¥ì„±ì´ ë†’ìŒ
- ìœ„ ë¬¸ì œë“¤ì„ í•´ê²°í•˜ê¸° ìœ„í•´ Soft ROI Selection ê¸°ë²•ì„ ê³ ì•ˆí•¨

![image](https://user-images.githubusercontent.com/77658029/135879663-b3dd8083-c35f-49c1-bfe4-14718bd91222.png)

1. ëª¨ë“  feature mapì—ì„œ ROI projectionì„ ì§„í–‰
2. ROI poolingì„ í†µí•´ ê³ ì •ëœ vectorë¡œ ì œì‘
3. channel wiseí•˜ê²Œ weightë¡œ summation ì§„í–‰í•¨(sigmoid)

<br><br><br>

**ğŸ“Œreference**
- boostcourse AI tech

<br>

```
ğŸ’¡ ìˆ˜ì • í•„ìš”í•œ ë‚´ìš©ì€ ëŒ“ê¸€ì´ë‚˜ ë©”ì¼ë¡œ ì•Œë ¤ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤!ğŸ’¡ 
```
